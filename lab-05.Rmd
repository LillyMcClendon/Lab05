---
title: "Lab 05 - Wrangling Spatial Data "
author: "Lilly McClendon"
date: "02-21-2025"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox) 
```

```{r load-data, message = FALSE}
states <- read_csv("data/states.csv")
```

### Exercise 1

```{r view-dennys-laquinta-data}
view(dennys)
view(laquinta)
```

```{r filter-dennys-alaska}
dn_ak <- dennys %>%
  filter(state == "AK")
nrow(dn_ak)
view(dn_ak)
```

```{r filter-laquinta-alaska}
lq_ak <- laquinta %>%
  filter(state == "AK")
nrow(lq_ak)
view(lq_ak)
```

### Exercise 2

#### Total combinations of Denny's and La Quinta Locations 

```{r filter-dennys-laquinta-alaska-combinations}
total_combinations <- nrow(dn_ak) * nrow(lq_ak)
print(total_combinations)
```

There are 6 total combinations of Denny's and La Quinta locations in Alaska. 


### Exercise 3

#### Joining Denny's in Alaska and La Quinta in Alaska datasets 

```{r join-dennys-ak-laquinta-ak}
dn_lq_ak <- full_join(dn_ak, lq_ak, 
                      by = "state")
dn_lq_ak
```

### Exercise 4

```{r observations-variablenames-joined-dn_lq_ak}
library(dplyr)
count(dn_lq_ak)
colnames(dn_lq_ak)
```

#### Number of observations in joined dn_lq_ak data frame

There are 6 observations in the joined dn_lq_ak data frame, which matches up with the number of total combinations (6) we calculated. 

#### Names of variables in joined dn_lq_ak data frame

The names of the variables in the joined dn_lq_ak data frame are address.x, 
city.x, state, zip.x, longitude.x, latitude.x, address.y, city.y, zip.y, longitude.y, and latitude.y. 

### Exercise 5

#### Tidyverse function to add a new variable to data frame while keeping existing variables 

The mutate function in Tidyverse can be used to add a new variable to a data frame while keeping the existing variables. 

```{r Haversine-distance-formula}
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 <- long1 * pi / 180
  lat1 <- lat1 * pi / 180
  long2 <- long2 * pi / 180
  lat2 <- lat2 * pi / 180

  R <- 6371 # Earth mean radius in km

  a <- sin((lat2 - lat1) / 2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1) / 2)^2
  d <- R * 2 * asin(sqrt(a))

  return(round(d, round)) # distance in km
}
```

### Exercise 6

```{r add_distance_to_dn_lq_ak}
dn_lq_ak <- dn_lq_ak %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))
```

### Exercise 7 

```{r min-dist-from-each-dennys-laquinta }
dn_lq_ak_mindist <- dn_lq_ak %>%
  group_by(address.x) %>%
  summarize(closest = min(distance))
```

### Exercise 8 

``` {r descriptive-stats}
summary(dn_lq_ak_mindist)
IQR(dn_lq_ak_mindist$closest)
table <- table(dn_lq_ak_mindist)
print(table)
barplot(table)
```

```{r outliers}

IQR_ak <- 1.982 
Minimum_ak <- 3.616 
Maximum_ak <- 5.598 
print(Minimum_ak - (IQR_ak*1.5))
print(Maximum_ak + (IQR_ak*1.5))
```

#### Description of the distribution of the distances between a Denny's and La Quinta for each Denny's location. 

The distribution of distances between a Denny's and La Quinta. The IQR method for identifying outliers has determined that none of the three minimum distances between a Denny's and La Quinta are outliers. The distances range from 2.035 to 5. 998, with the average distance equaling 4.410 and a median of 5.197.  

```{r barplot-visualization}
ggplot(dn_lq_ak_mindist, aes(x = forcats::fct_reorder(address.x, desc(closest)), y = closest)) + 
  geom_col() + 
  labs(
    title = "Distance between Denny's and La Quinta Locations in Alaska",
    x = "Denny's Address",
    y = "Distance (km)"
  )
```

```{r Alaska-point-and-distance-plot}
library(ggplot2)
dn_lq_ak <- dn_lq_ak %>% 
  mutate(id = row_number())
ggplot(dn_lq_ak) +
  geom_point(aes(x = longitude.x, y = latitude.x), color = "red") +
  geom_point(aes(x = longitude.y, y = latitude.y), color = "green") +
  geom_segment(aes(x = longitude.x, y = latitude.x, xend = longitude.y, yend = latitude.y, color = factor(id))) +
  scale_color_discrete(name = "Row ID") + 
  labs(
    title = "Distance between Denny's and La Quinta Locations in Alaska",
    x = "Longitude",
    y = "Latitude"
  )
```
