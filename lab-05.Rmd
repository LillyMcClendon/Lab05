---
title: "Lab 05 - Wrangling Spatial Data "
author: "Lilly McClendon"
date: "02-21-2025"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox) 
```

```{r load-data, message = FALSE}
states <- read_csv("data/states.csv")
```

### Exercise 1

```{r view-dennys-laquinta-data}
view(dennys)
view(laquinta)
```

```{r filter-dennys-alaska}
dn_ak <- dennys %>%
  filter(state == "AK")
nrow(dn_ak)
view(dn_ak)
```

```{r filter-laquinta-alaska}
lq_ak <- laquinta %>%
  filter(state == "AK")
nrow(lq_ak)
view(lq_ak)
```

### Exercise 2

#### Total combinations of Denny's and La Quinta Locations 

```{r filter-dennys-laquinta-alaska-combinations}
total_combinations <- nrow(dn_ak) * nrow(lq_ak)
print(total_combinations)
```

There are 6 total combinations of Denny's and La Quinta locations in Alaska. 


### Exercise 3

#### Joining Denny's in Alaska and La Quinta in Alaska datasets 

```{r join-dennys-ak-laquinta-ak}
dn_lq_ak <- full_join(dn_ak, lq_ak, 
                      by = "state")
dn_lq_ak
```

### Exercise 4

```{r observations-variablenames-joined-dn_lq_ak}
library(dplyr)
count(dn_lq_ak)
colnames(dn_lq_ak)
```

#### Number of observations in joined dn_lq_ak data frame

There are 6 observations in the joined dn_lq_ak data frame, which matches up with the number of total combinations (6) we calculated. 

#### Names of variables in joined dn_lq_ak data frame

The names of the variables in the joined dn_lq_ak data frame are address.x, 
city.x, state, zip.x, longitude.x, latitude.x, address.y, city.y, zip.y, longitude.y, and latitude.y. 

### Exercise 5

#### Tidyverse function to add a new variable to data frame while keeping existing variables 

The mutate function in Tidyverse can be used to add a new variable to a data frame while keeping the existing variables. 

```{r Haversine-distance-formula}
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 <- long1 * pi / 180
  lat1 <- lat1 * pi / 180
  long2 <- long2 * pi / 180
  lat2 <- lat2 * pi / 180

  R <- 6371 # Earth mean radius in km

  a <- sin((lat2 - lat1) / 2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1) / 2)^2
  d <- R * 2 * asin(sqrt(a))

  return(round(d, round)) # distance in km
}
```

### Exercise 6

```{r add_distance_to_dn_lq_ak}
dn_lq_ak <- dn_lq_ak %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))
```

### Exercise 7 

```{r min-dist-from-each-dennys-laquinta }
dn_lq_ak_mindist <- dn_lq_ak %>%
  group_by(address.x) %>%
  summarize(closest = min(distance))
```

### Exercise 8 

``` {r descriptive-stats}
summary(dn_lq_ak_mindist)
IQR(dn_lq_ak_mindist$closest)
table <- table(dn_lq_ak_mindist)
print(table)
barplot(table)
```

```{r outliers}

IQR_ak <- 1.982 
quart1_ak <- 3.616 
quart3_ak <- 5.598 
print(quart1_ak - (IQR_ak*1.5))
print(quart3_ak + (IQR_ak*1.5))
```

#### Description of the distribution of the distances between a Denny's and La Quinta for each Denny's location in Alaska. 

The distribution of distances between a Denny's and La Quinta. The IQR method for identifying outliers has determined that none of the three minimum distances between a Denny's and La Quinta are outliers. The distances range from 2.035 to 5. 998, with the average distance equaling 4.410 and a median of 5.197.  

```{r barplot-visualization}
ggplot(dn_lq_ak_mindist, aes(x = forcats::fct_reorder(address.x, desc(closest)), y = closest)) + 
  geom_col() + 
  labs(
    title = "Distance between Denny's and La Quinta Locations in Alaska",
    x = "Denny's Address",
    y = "Distance (km)"
  )
```

### Exercise 9

```{r filter-dennys-north-carolina}
dn_nc <- dennys %>%
  filter(state == "NC")
nrow(dn_nc)
view(dn_nc)
```

```{r filter-laquinta-north-carolina}
lq_nc <- laquinta %>%
  filter(state == "NC")
nrow(lq_nc)
view(lq_nc)
```

```{r filter-dennys-laquinta-north-carolina-combinations}
total_combinations_nc <- nrow(dn_nc) * nrow(lq_nc)
print(total_combinations_nc)
```

There are 336 total combinations of Denny's and La Quinta locations in Texas. 

```{r join-dennys-nc-laquinta-nc}
dn_lq_nc <- full_join(dn_nc, lq_nc, 
                      by = "state")
dn_lq_nc
```

```{r observations-variablenames-joined-dn_lq_nc}
library(dplyr)
count(dn_lq_nc)
colnames(dn_lq_nc)
```

```{r add_distance_to_dn_lq_nc}
dn_lq_nc <- dn_lq_nc %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))
```

```{r min-dist-from-each-dennys-laquinta-nc }
dn_lq_nc_mindist <- dn_lq_nc %>%
  group_by(address.x) %>%
  summarize(closest = min(distance))
```

``` {r descriptive-stats-nc}
summary(dn_lq_nc_mindist)
IQR(dn_lq_nc_mindist$closest)
table <- table(dn_lq_nc_mindist)
```

```{r outliers-nc}

IQR_nc <- 71.597 
quart1_nc <- 22.388
quart3_nc <- 93.985
print(quart1_nc - (IQR_nc*1.5))
print(quart3_nc + (IQR_nc*1.5))
```

#### Description of the distribution of the distances between a Denny's and La Quinta for each Denny's location in North Carolina. 

The IQR method for identifying outliers has determined that none of the 28 minimum distances between a Denny's and La Quinta are outliers in North Carolina. The distances range from 1.779 to 187.935, with the average distance equaling 65.444 and a median of 53.456.  

```{r barplot-visualization-nc}
ggplot(dn_lq_nc_mindist, aes(x = forcats::fct_reorder(address.x, desc(closest)), y = closest)) + 
  geom_col() + 
  labs(
    title = "Distance between Denny's and La Quinta Locations in North Carolina",
    x = "Denny's Address",
    y = "Distance (km)"
  ) + 
  coord_flip()
```

### Exercise 10 

```{r filter-dennys-texas}
dn_tx <- dennys %>%
  filter(state == "TX")
nrow(dn_tx)
view(dn_tx)
```

```{r filter-laquinta-texas}
lq_tx <- laquinta %>%
  filter(state == "TX")
nrow(lq_tx)
view(lq_tx)
```

#### Total combinations of Denny's and La Quinta Locations in Texas 

```{r filter-dennys-laquinta-texas-combinations}
total_combinations_tx <- nrow(dn_tx) * nrow(lq_tx)
print(total_combinations_tx)
```

There are 47,400 total combinations of Denny's and La Quinta locations in Texas. 

#### Joining Denny's in Texas and La Quinta in Texas datasets 
```{r join-dennys-tx-laquinta-tx}
dn_lq_tx <- full_join(dn_tx, lq_tx, 
                      by = "state")
dn_lq_tx
```

```{r observations-variablenames-joined-dn_lq_tx}
library(dplyr)
count(dn_lq_tx)
colnames(dn_lq_tx)
```
#### Number of observations in joined dn_lq_tx data frame

There are 47,400 observations in the joined dn_lq_ak data frame, which matches up with the number of total combinations (47,400) we calculated. 

#### Names of variables in joined dn_lq_tx data frame

The names of the variables in the joined dn_lq_tx data frame are address.x, city.x, state, zip.x, longitude.x, latitude.x, address.y, city.y, zip.y, longitude.y, and latitude.y. 


```{r add_distance_to_dn_lq_tx}
dn_lq_tx <- dn_lq_tx %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y, round = 3))
```

```{r min-dist-from-each-dennys-laquinta-tx }
dn_lq_tx_mindist <- dn_lq_tx %>%
  group_by(address.x) %>%
  summarize(closest = min(distance))
```

``` {r descriptive-stats-tx}
summary(dn_lq_tx_mindist)
IQR(dn_lq_tx_mindist$closest)
table <- table(dn_lq_tx_mindist)
```

```{r outliers-tx}

IQR_tx <- 5.89975
quart1_tx <- 0.7305 
quart3_tx <- 6.6303 
print(quart1_tx - (IQR_tx*1.5))
print(quart3_tx + (IQR_tx*1.5))
```

#### Description of the distribution of the distances between a Denny's and La Quinta for each Denny's location. 

The IQR method for identifying outliers has determined that none of the ___ minimum distances between a Denny's and La Quinta are outliers in Texas. The distances range from 0.0160 to 60.5820 with the average distance equaling 5.7918 and a median of 3.3715.  

```{r barplot-visualization-texas}
ggplot(dn_lq_tx_mindist, aes(x = forcats::fct_reorder(address.x, desc(closest)), y = closest)) + 
  geom_col() + 
  labs(
    title = "Distance between Denny's and La Quinta Locations in Texas",
    x = "Denny's Address",
    y = "Distance (km)"
  ) +
coord_flip()
```

